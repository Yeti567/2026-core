# Dependency Vulnerability Report
**Date:** January 19, 2026  
**Status:** 6 High Severity Vulnerabilities Found

---

## Executive Summary

‚úÖ **Critical Next.js vulnerabilities:** FIXED (updated to 14.2.35)  
‚ö†Ô∏è **High severity vulnerabilities:** 6 remaining (all related to PDF processing libraries)

**Overall Status:** Good - Critical issues resolved, high priority issues identified

---

## Vulnerability Details

### High Severity Issues (6 total)

All vulnerabilities stem from the `tar` package vulnerability (GHSA-8qq5-rm4j-mr97) which affects PDF processing libraries.

#### 1. **tar** (Indirect Dependency)
- **Severity:** High
- **CVE:** GHSA-8qq5-rm4j-mr97
- **Issue:** Arbitrary File Overwrite and Symlink Poisoning via Insufficient Path Sanitization
- **Affected Range:** <=7.5.2
- **Fix Available:** Yes (via pdf-to-img@5.0.0 - breaking change)

#### 2. **@mapbox/node-pre-gyp** (Indirect Dependency)
- **Severity:** High
- **Via:** tar
- **Affected Range:** <=1.0.11
- **Used By:** canvas
- **Fix Available:** Yes (via pdf-to-img@5.0.0)

#### 3. **canvas** (Indirect Dependency)
- **Severity:** High
- **Via:** @mapbox/node-pre-gyp
- **Affected Range:** 2.8.0 - 2.11.2
- **Used By:** pdfjs-dist
- **Fix Available:** Yes (via pdf-to-img@5.0.0)

#### 4. **pdfjs-dist** (Indirect Dependency)
- **Severity:** High
- **Via:** canvas
- **Affected Range:** 3.0.279 - 4.7.76
- **Used By:** pdf-to-img, react-pdf
- **Fix Available:** Yes (via pdf-to-img@5.0.0)

#### 5. **pdf-to-img** (Direct Dependency)
- **Severity:** High
- **Via:** pdfjs-dist
- **Current Version:** 4.5.0
- **Affected Range:** 2.0.0 - 4.5.0
- **Fix Available:** ‚úÖ **5.0.0** (breaking change)

#### 6. **react-pdf** (Direct Dependency)
- **Severity:** High
- **Via:** pdfjs-dist
- **Current Version:** 9.1.0
- **Affected Range:** 7.0.0-beta - 9.1.1
- **Fix Available:** ‚úÖ **9.2.1** (minor update) or **10.3.0** (major update)

---

## Dependency Chain

```
tar (vulnerable)
  ‚îî‚îÄ‚îÄ @mapbox/node-pre-gyp
      ‚îî‚îÄ‚îÄ canvas
          ‚îî‚îÄ‚îÄ pdfjs-dist
              ‚îú‚îÄ‚îÄ pdf-to-img (4.5.0) ‚Üê Direct dependency
              ‚îî‚îÄ‚îÄ react-pdf (9.1.0) ‚Üê Direct dependency
```

---

## Recommended Actions

### Option 1: Safe Update (Recommended First Step)

Update `react-pdf` to latest minor version (non-breaking):

```bash
npm install react-pdf@9.2.1
```

This may resolve some vulnerabilities without breaking changes.

### Option 2: Full Fix (Requires Testing)

Update both PDF libraries to latest versions (breaking changes):

```bash
# Update pdf-to-img (major version bump)
npm install pdf-to-img@5.0.0

# Update react-pdf (major version bump)
npm install react-pdf@10.3.0
```

**‚ö†Ô∏è Warning:** These are breaking changes. Review changelogs:
- [pdf-to-img v5 changelog](https://github.com/nickolanack/pdf-to-img/releases)
- [react-pdf v10 changelog](https://github.com/wojtekmaj/react-pdf/releases)

### Option 3: Force Fix (Use with Caution)

```bash
npm audit fix --force
```

This will update all packages including breaking changes. **Test thoroughly before deploying.**

---

## Impact Assessment

### Risk Level: **MEDIUM**

**Why Medium and not High?**
1. The `tar` vulnerability requires specific conditions to exploit
2. These are indirect dependencies (not directly used in your code)
3. The vulnerability affects file extraction operations, which are:
   - Server-side only (PDF processing)
   - User-controlled input is already validated
   - Files are stored in Supabase Storage (isolated)

**Attack Vector:**
- An attacker would need to upload a malicious PDF that exploits the tar vulnerability
- This would require:
  1. Access to upload PDFs (already rate-limited ‚úÖ)
  2. Ability to craft a malicious PDF that exploits tar during extraction
  3. Server-side file processing to trigger the vulnerability

**Mitigation:**
- ‚úÖ File uploads are rate-limited
- ‚úÖ File type validation (MIME + magic bytes)
- ‚úÖ Files stored in isolated Supabase Storage
- ‚úÖ Server-side processing only

---

## Testing Checklist

After updating dependencies:

- [ ] **PDF Upload:** Test document upload functionality
- [ ] **PDF Processing:** Test PDF text extraction
- [ ] **PDF Display:** Test react-pdf component rendering
- [ ] **Form Conversion:** Test PDF form conversion features
- [ ] **Bulk Upload:** Test bulk document upload
- [ ] **Error Handling:** Verify error messages still work
- [ ] **Build:** Ensure production build succeeds
- [ ] **TypeScript:** Check for type errors

---

## Outdated Packages Summary

| Package | Current | Latest | Type | Security Risk |
|---------|---------|--------|------|---------------|
| **pdf-to-img** | 4.5.0 | 5.0.0 | Major | üî¥ High (vulnerable) |
| **react-pdf** | 9.1.0 | 10.3.0 | Major | üî¥ High (vulnerable) |
| next | 14.2.35 | 16.1.4 | Major | üü¢ Low (secure) |
| react | 18.3.1 | 19.2.3 | Major | üü¢ Low (secure) |
| zod | 3.25.76 | 4.3.5 | Major | üü¢ Low (secure) |
| @supabase/ssr | 0.8.0 | 0.8.0 | - | ‚úÖ Up to date |

---

## Next Steps

1. **Immediate:** Update `react-pdf` to 9.2.1 (safe, non-breaking)
2. **Short-term:** Plan migration to pdf-to-img@5.0.0 and react-pdf@10.3.0
3. **Testing:** Create test suite for PDF processing features
4. **Monitoring:** Set up dependency vulnerability alerts

---

## Commands Reference

```bash
# Check vulnerabilities
npm audit

# Get detailed JSON report
npm audit --json > security-audit.json

# Check outdated packages
npm outdated

# Safe fixes only
npm audit fix

# All fixes (including breaking changes)
npm audit fix --force

# Update specific packages
npm install pdf-to-img@5.0.0 react-pdf@10.3.0
```

---

## Additional Notes

- The `tar` vulnerability is in a transitive dependency, not directly in your code
- Your application already has security measures (rate limiting, file validation)
- Consider implementing dependency vulnerability scanning in CI/CD pipeline
- Monitor GitHub Security Advisories for updates

---

**Report Generated:** January 19, 2026  
**Next Review:** After dependency updates
