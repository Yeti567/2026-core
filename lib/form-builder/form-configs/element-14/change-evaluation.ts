/**
 * Change Evaluation Form
 * COR Element 14: Management System
 * 
 * Evaluate changes to the safety management system.
 */

import type { FormConfig } from '../../import-forms';

export const changeEvaluation: FormConfig = {
  code: 'change_evaluation',
  name: 'Safety Management System Change Evaluation',
  description: 'Evaluate proposed or implemented changes to the occupational health and safety management system.',
  cor_element: 14,
  frequency: 'as_needed',
  estimated_time_minutes: 30,
  icon: 'GitBranch',
  color: '#F59E0B',
  is_mandatory: true,

  sections: [
    {
      title: 'Change Information',
      order_index: 0,
      fields: [
        {
          code: 'evaluation_date',
          label: 'Evaluation Date',
          field_type: 'date',
          default_value: 'today',
          validation_rules: { required: true },
          order_index: 0,
          width: 'half',
        },
        {
          code: 'evaluator',
          label: 'Evaluated By',
          field_type: 'worker_select',
          validation_rules: { required: true },
          order_index: 1,
          width: 'half',
        },
        {
          code: 'change_reference',
          label: 'Change Reference Number',
          field_type: 'text',
          placeholder: 'CHG-2025-001',
          validation_rules: { required: true },
          order_index: 2,
          width: 'half',
        },
        {
          code: 'evaluation_type',
          label: 'Evaluation Type',
          field_type: 'dropdown',
          options: [
            { value: 'pre_implementation', label: 'Pre-Implementation Review' },
            { value: 'post_implementation', label: 'Post-Implementation Review' },
            { value: 'effectiveness', label: 'Effectiveness Evaluation' },
          ],
          validation_rules: { required: true },
          order_index: 3,
          width: 'half',
        },
        {
          code: 'change_type',
          label: 'Type of Change',
          field_type: 'multiselect',
          options: [
            { value: 'policy', label: 'Policy Change' },
            { value: 'procedure', label: 'Procedure Change' },
            { value: 'organizational', label: 'Organizational Change' },
            { value: 'equipment', label: 'Equipment/Technology' },
            { value: 'process', label: 'Process Change' },
            { value: 'regulatory', label: 'Regulatory Compliance' },
            { value: 'training', label: 'Training Program' },
          ],
          validation_rules: { required: true },
          order_index: 4,
          width: 'full',
        },
      ],
    },
    {
      title: 'Change Description',
      order_index: 1,
      fields: [
        {
          code: 'change_title',
          label: 'Change Title/Summary',
          field_type: 'text',
          validation_rules: { required: true },
          order_index: 0,
          width: 'full',
        },
        {
          code: 'change_description',
          label: 'Detailed Description of Change',
          field_type: 'textarea',
          placeholder: 'Describe the change in detail...',
          validation_rules: { required: true, min_length: 50 },
          order_index: 1,
          width: 'full',
        },
        {
          code: 'reason_for_change',
          label: 'Reason for Change',
          field_type: 'textarea',
          placeholder: 'Why is this change being made?',
          validation_rules: { required: true },
          order_index: 2,
          width: 'full',
        },
        {
          code: 'expected_benefits',
          label: 'Expected Benefits',
          field_type: 'textarea',
          placeholder: 'What benefits are expected from this change?',
          validation_rules: { required: true },
          order_index: 3,
          width: 'full',
        },
        {
          code: 'affected_areas',
          label: 'Affected Areas/Departments',
          field_type: 'textarea',
          validation_rules: { required: true },
          order_index: 4,
          width: 'full',
        },
      ],
    },
    {
      title: 'Risk Assessment',
      order_index: 2,
      fields: [
        {
          code: 'introduces_new_risks',
          label: 'Does this change introduce new risks?',
          field_type: 'radio',
          options: ['Yes', 'No', 'Possibly'],
          validation_rules: { required: true },
          order_index: 0,
          width: 'full',
        },
        {
          code: 'new_risks_description',
          label: 'Description of New Risks',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'introduces_new_risks',
            operator: 'not_equals',
            value: 'No',
          },
          order_index: 1,
          width: 'full',
        },
        {
          code: 'risk_mitigation',
          label: 'Risk Mitigation Measures',
          field_type: 'textarea',
          placeholder: 'How will new risks be mitigated?',
          conditional_logic: {
            field_code: 'introduces_new_risks',
            operator: 'not_equals',
            value: 'No',
          },
          order_index: 2,
          width: 'full',
        },
        {
          code: 'affects_existing_controls',
          label: 'Does it affect existing safety controls?',
          field_type: 'radio',
          options: ['Yes', 'No'],
          validation_rules: { required: true },
          order_index: 3,
          width: 'full',
        },
        {
          code: 'control_impact',
          label: 'Impact on Existing Controls',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'affects_existing_controls',
            operator: 'equals',
            value: 'Yes',
          },
          order_index: 4,
          width: 'full',
        },
        {
          code: 'residual_risk_acceptable',
          label: 'Is residual risk acceptable?',
          field_type: 'radio',
          options: ['Yes', 'No', 'With conditions'],
          validation_rules: { required: true },
          order_index: 5,
          width: 'full',
        },
      ],
    },
    {
      title: 'Implementation Requirements',
      order_index: 3,
      fields: [
        {
          code: 'training_required',
          label: 'Is training required?',
          field_type: 'radio',
          options: ['Yes', 'No'],
          validation_rules: { required: true },
          order_index: 0,
          width: 'full',
        },
        {
          code: 'training_details',
          label: 'Training Requirements',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'training_required',
            operator: 'equals',
            value: 'Yes',
          },
          order_index: 1,
          width: 'full',
        },
        {
          code: 'documentation_changes',
          label: 'Documentation Changes Required',
          field_type: 'textarea',
          placeholder: 'What documents need to be updated?',
          order_index: 2,
          width: 'full',
        },
        {
          code: 'communication_requirements',
          label: 'Communication Requirements',
          field_type: 'textarea',
          placeholder: 'How will the change be communicated?',
          validation_rules: { required: true },
          order_index: 3,
          width: 'full',
        },
        {
          code: 'resource_requirements',
          label: 'Resource Requirements',
          field_type: 'textarea',
          order_index: 4,
          width: 'full',
        },
        {
          code: 'implementation_timeline',
          label: 'Implementation Timeline',
          field_type: 'text',
          order_index: 5,
          width: 'full',
        },
      ],
    },
    {
      title: 'Effectiveness Criteria',
      order_index: 4,
      fields: [
        {
          code: 'success_criteria',
          label: 'How will success be measured?',
          field_type: 'textarea',
          placeholder: 'Define the criteria for determining if the change is effective...',
          validation_rules: { required: true },
          order_index: 0,
          width: 'full',
        },
        {
          code: 'review_frequency',
          label: 'Review Frequency',
          field_type: 'dropdown',
          options: [
            { value: 'monthly', label: 'Monthly' },
            { value: 'quarterly', label: 'Quarterly' },
            { value: 'semi_annual', label: 'Semi-Annual' },
            { value: 'annual', label: 'Annual' },
          ],
          validation_rules: { required: true },
          order_index: 1,
          width: 'half',
        },
        {
          code: 'first_review_date',
          label: 'First Review Date',
          field_type: 'date',
          validation_rules: { required: true },
          order_index: 2,
          width: 'half',
        },
        {
          code: 'kpis_affected',
          label: 'KPIs Affected',
          field_type: 'textarea',
          placeholder: 'Which KPIs will be used to measure effectiveness?',
          order_index: 3,
          width: 'full',
        },
      ],
    },
    {
      title: 'Evaluation Decision',
      order_index: 5,
      fields: [
        {
          code: 'recommendation',
          label: 'Recommendation',
          field_type: 'dropdown',
          options: [
            { value: 'approve', label: 'Approve - Proceed with change' },
            { value: 'approve_conditions', label: 'Approve with Conditions' },
            { value: 'defer', label: 'Defer - More information needed' },
            { value: 'reject', label: 'Reject - Do not proceed' },
          ],
          validation_rules: { required: true },
          order_index: 0,
          width: 'half',
        },
        {
          code: 'conditions',
          label: 'Conditions/Requirements',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'recommendation',
            operator: 'not_equals',
            value: 'approve',
          },
          order_index: 1,
          width: 'full',
        },
        {
          code: 'rejection_reason',
          label: 'Reason for Rejection',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'recommendation',
            operator: 'equals',
            value: 'reject',
          },
          order_index: 2,
          width: 'full',
        },
        {
          code: 'additional_comments',
          label: 'Additional Comments',
          field_type: 'textarea',
          order_index: 3,
          width: 'full',
        },
      ],
    },
    {
      title: 'Sign-Off',
      order_index: 6,
      fields: [
        {
          code: 'evaluator_signature',
          label: 'Evaluator Signature',
          field_type: 'signature',
          validation_rules: { required: true },
          order_index: 0,
          width: 'half',
        },
        {
          code: 'approval_signature',
          label: 'Approval Authority Signature',
          field_type: 'signature',
          validation_rules: { required: true },
          order_index: 1,
          width: 'half',
        },
      ],
    },
  ],

  workflow: {
    submit_to_role: 'admin',
    notify_roles: ['internal_auditor'],
    sync_priority: 3,
    requires_approval: true,
  },
};
