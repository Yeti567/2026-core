/**
 * Contractor Performance Evaluation Form
 * COR Element 4: Competency & Training
 * 
 * Evaluate contractor safety performance during and after work completion.
 */

import type { FormConfig } from '../../import-forms';

export const contractorEvaluation: FormConfig = {
  code: 'contractor_evaluation',
  name: 'Contractor Performance Evaluation',
  description: 'Evaluate contractor safety performance during and after work completion to inform future engagement decisions.',
  cor_element: 4,
  frequency: 'as_needed',
  estimated_time_minutes: 20,
  icon: 'ClipboardList',
  color: '#EC4899',
  is_mandatory: true,

  sections: [
    {
      title: 'Evaluation Details',
      order_index: 0,
      fields: [
        {
          code: 'evaluation_date',
          label: 'Evaluation Date',
          field_type: 'date',
          default_value: 'today',
          validation_rules: { required: true },
          order_index: 0,
          width: 'half',
        },
        {
          code: 'evaluation_type',
          label: 'Evaluation Type',
          field_type: 'dropdown',
          options: [
            { value: 'mid_project', label: 'Mid-Project Evaluation' },
            { value: 'end_project', label: 'End of Project' },
            { value: 'periodic', label: 'Periodic Review' },
            { value: 'incident_related', label: 'Incident-Related' },
          ],
          validation_rules: { required: true },
          order_index: 1,
          width: 'half',
        },
        {
          code: 'evaluator',
          label: 'Evaluated By',
          field_type: 'worker_select',
          validation_rules: { required: true },
          order_index: 2,
          width: 'full',
        },
        {
          code: 'contractor_name',
          label: 'Contractor Company Name',
          field_type: 'text',
          validation_rules: { required: true },
          order_index: 3,
          width: 'full',
        },
        {
          code: 'jobsite',
          label: 'Jobsite/Location',
          field_type: 'jobsite_select',
          validation_rules: { required: true },
          order_index: 4,
          width: 'half',
        },
        {
          code: 'project_name',
          label: 'Project Name/Description',
          field_type: 'text',
          validation_rules: { required: true },
          order_index: 5,
          width: 'half',
        },
        {
          code: 'work_period_start',
          label: 'Work Period Start',
          field_type: 'date',
          validation_rules: { required: true },
          order_index: 6,
          width: 'half',
        },
        {
          code: 'work_period_end',
          label: 'Work Period End',
          field_type: 'date',
          order_index: 7,
          width: 'half',
        },
      ],
    },
    {
      title: 'Safety Performance Rating',
      description: 'Rate contractor performance in each area (1=Poor, 5=Excellent)',
      order_index: 1,
      fields: [
        {
          code: 'compliance_rating',
          label: 'Safety Program Compliance',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          help_text: 'Compliance with site safety rules and procedures',
          validation_rules: { required: true },
          order_index: 0,
          width: 'half',
        },
        {
          code: 'ppe_rating',
          label: 'PPE Usage',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          help_text: 'Proper use of required PPE',
          validation_rules: { required: true },
          order_index: 1,
          width: 'half',
        },
        {
          code: 'housekeeping_rating',
          label: 'Housekeeping',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          help_text: 'Work area organization and cleanliness',
          validation_rules: { required: true },
          order_index: 2,
          width: 'half',
        },
        {
          code: 'hazard_reporting_rating',
          label: 'Hazard Identification & Reporting',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          validation_rules: { required: true },
          order_index: 3,
          width: 'half',
        },
        {
          code: 'communication_rating',
          label: 'Safety Communication',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          help_text: 'Communication with site personnel about safety',
          validation_rules: { required: true },
          order_index: 4,
          width: 'half',
        },
        {
          code: 'training_rating',
          label: 'Worker Training & Competency',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          validation_rules: { required: true },
          order_index: 5,
          width: 'half',
        },
        {
          code: 'equipment_rating',
          label: 'Equipment & Tool Safety',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          validation_rules: { required: true },
          order_index: 6,
          width: 'half',
        },
        {
          code: 'documentation_rating',
          label: 'Safety Documentation',
          field_type: 'dropdown',
          options: [
            { value: '1', label: '1 - Poor' },
            { value: '2', label: '2 - Below Average' },
            { value: '3', label: '3 - Average' },
            { value: '4', label: '4 - Good' },
            { value: '5', label: '5 - Excellent' },
          ],
          help_text: 'Proper completion of required safety documents',
          validation_rules: { required: true },
          order_index: 7,
          width: 'half',
        },
      ],
    },
    {
      title: 'Incident History',
      description: 'Record any safety incidents during work period',
      order_index: 2,
      fields: [
        {
          code: 'incidents_occurred',
          label: 'Were there any safety incidents?',
          field_type: 'radio',
          options: ['Yes', 'No'],
          validation_rules: { required: true },
          order_index: 0,
          width: 'full',
        },
        {
          code: 'incident_count',
          label: 'Number of Incidents',
          field_type: 'number',
          conditional_logic: {
            field_code: 'incidents_occurred',
            operator: 'equals',
            value: 'Yes',
          },
          validation_rules: { min_value: 0 },
          order_index: 1,
          width: 'half',
        },
        {
          code: 'near_miss_count',
          label: 'Number of Near Misses',
          field_type: 'number',
          conditional_logic: {
            field_code: 'incidents_occurred',
            operator: 'equals',
            value: 'Yes',
          },
          validation_rules: { min_value: 0 },
          order_index: 2,
          width: 'half',
        },
        {
          code: 'incident_details',
          label: 'Incident Details',
          field_type: 'textarea',
          placeholder: 'Briefly describe any incidents that occurred...',
          conditional_logic: {
            field_code: 'incidents_occurred',
            operator: 'equals',
            value: 'Yes',
          },
          order_index: 3,
          width: 'full',
        },
        {
          code: 'safety_violations',
          label: 'Were there any safety violations/warnings issued?',
          field_type: 'radio',
          options: ['Yes', 'No'],
          validation_rules: { required: true },
          order_index: 4,
          width: 'full',
        },
        {
          code: 'violation_details',
          label: 'Violation Details',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'safety_violations',
            operator: 'equals',
            value: 'Yes',
          },
          order_index: 5,
          width: 'full',
        },
      ],
    },
    {
      title: 'Overall Evaluation',
      order_index: 3,
      fields: [
        {
          code: 'overall_rating',
          label: 'Overall Safety Performance',
          field_type: 'dropdown',
          options: [
            { value: 'excellent', label: 'Excellent - Recommend for future work' },
            { value: 'good', label: 'Good - Would use again' },
            { value: 'satisfactory', label: 'Satisfactory - Acceptable performance' },
            { value: 'poor', label: 'Poor - Significant concerns' },
            { value: 'unacceptable', label: 'Unacceptable - Do not use again' },
          ],
          validation_rules: { required: true },
          order_index: 0,
          width: 'full',
        },
        {
          code: 'strengths',
          label: 'Strengths',
          field_type: 'textarea',
          placeholder: 'What did the contractor do well?',
          order_index: 1,
          width: 'full',
        },
        {
          code: 'areas_for_improvement',
          label: 'Areas for Improvement',
          field_type: 'textarea',
          placeholder: 'What could the contractor improve?',
          order_index: 2,
          width: 'full',
        },
        {
          code: 'would_rehire',
          label: 'Would you recommend this contractor for future work?',
          field_type: 'radio',
          options: ['Yes', 'Yes with conditions', 'No'],
          validation_rules: { required: true },
          order_index: 3,
          width: 'full',
        },
        {
          code: 'rehire_conditions',
          label: 'Conditions for Future Work',
          field_type: 'textarea',
          conditional_logic: {
            field_code: 'would_rehire',
            operator: 'equals',
            value: 'Yes with conditions',
          },
          order_index: 4,
          width: 'full',
        },
        {
          code: 'additional_comments',
          label: 'Additional Comments',
          field_type: 'textarea',
          order_index: 5,
          width: 'full',
        },
      ],
    },
    {
      title: 'Sign-Off',
      order_index: 4,
      fields: [
        {
          code: 'evaluator_signature',
          label: 'Evaluator Signature',
          field_type: 'signature',
          validation_rules: { required: true },
          order_index: 0,
          width: 'half',
        },
        {
          code: 'supervisor_signature',
          label: 'Supervisor Acknowledgment',
          field_type: 'signature',
          order_index: 1,
          width: 'half',
        },
      ],
    },
  ],

  workflow: {
    submit_to_role: 'admin',
    notify_roles: ['supervisor'],
    sync_priority: 3,
    requires_approval: false,
  },
};
